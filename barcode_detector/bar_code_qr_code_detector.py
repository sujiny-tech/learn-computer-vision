import pyzbar.pyzbar as pyzbar
import cv2
import matplotlib.pyplot as plt


code_country=['U.S and Canada', 'U.S and Canada', 'U.S and Canada', 'U.S and Canada', 'U.S and Canada', 'U.S and Canada', 'U.S and Canada', 'U.S and Canada', 'U.S and Canada', 'U.S and Canada', 'U.S and Canada', 'U.S and Canada', 'U.S and Canada', 'U.S and Canada', 'U.S and Canada', 'U.S and Canada', 'U.S and Canada', 'U.S and Canada', 'U.S and Canada', 'U.S and Canada', 'NULL', 'NULL', 'NULL', 'NULL', 'NULL', 'NULL', 'NULL', 'NULL', 'NULL', 'NULL', 'NULL', 'NULL', 'NULL', 'NULL', 'NULL', 'NULL', 'NULL', 'NULL', 'NULL', 'NULL', 'NULL', 'NULL', 'NULL', 'NULL', 'NULL', 'NULL', 'NULL', 'NULL', 'NULL', 'NULL', 'NULL', 'NULL', 'NULL', 'NULL', 'NULL', 'NULL', 'NULL', 'NULL', 'NULL', 'NULL', 'U.S and Canada', 'U.S and Canada', 'U.S and Canada', 'U.S and Canada', 'U.S and Canada', 'U.S and Canada', 'U.S and Canada', 'U.S and Canada', 'U.S and Canada', 'U.S and Canada', 'U.S and Canada', 'U.S and Canada', 'U.S and Canada', 'U.S and Canada', 'U.S and Canada', 'U.S and Canada', 'U.S and Canada', 'U.S and Canada', 'U.S and Canada', 'U.S and Canada', 'U.S and Canada', 'U.S and Canada', 'U.S and Canada', 'U.S and Canada', 'U.S and Canada', 'U.S and Canada', 'U.S and Canada', 'U.S and Canada', 'U.S and Canada', 'U.S and Canada', 'U.S and Canada', 'U.S and Canada', 'U.S and Canada', 'U.S and Canada', 'U.S and Canada', 'U.S and Canada', 'U.S and Canada', 'U.S and Canada', 'U.S and Canada', 'U.S and Canada', 'NULL', 'NULL', 'NULL', 'NULL', 'NULL', 'NULL', 'NULL', 'NULL', 'NULL', 'NULL', 'NULL', 'NULL', 'NULL', 'NULL', 'NULL', 'NULL', 'NULL', 'NULL', 'NULL', 'NULL', 'NULL', 'NULL', 'NULL', 'NULL', 'NULL', 'NULL', 'NULL', 'NULL', 'NULL', 'NULL', 'NULL', 'NULL', 'NULL', 'NULL', 'NULL', 'NULL', 'NULL', 'NULL', 'NULL', 'NULL', 'NULL', 'NULL', 'NULL', 'NULL', 'NULL', 'NULL', 'NULL', 'NULL', 'NULL', 'NULL', 'NULL', 'NULL', 'NULL', 'NULL', 'NULL', 'NULL', 'NULL', 'NULL', 'NULL', 'NULL', 'NULL', 'NULL', 'NULL', 'NULL', 'NULL', 'NULL', 'NULL', 'NULL', 'NULL', 'NULL', 'NULL', 'NULL', 'NULL', 'NULL', 'NULL', 'NULL', 'NULL', 'NULL', 'NULL', 'NULL', 'NULL', 'NULL', 'NULL', 'NULL', 'NULL', 'NULL', 'NULL', 'NULL', 'NULL', 'NULL', 'NULL', 'NULL', 'NULL', 'NULL', 'NULL', 'NULL', 'NULL', 'NULL', 'NULL', 'NULL', 'NULL', 'NULL', 'NULL', 'NULL', 'NULL', 'NULL', 'NULL', 'NULL', 'NULL', 'NULL', 'NULL', 'NULL', 'NULL', 'NULL', 'NULL', 'NULL', 'NULL', 'NULL', 'NULL', 'NULL', 'NULL', 'NULL', 'NULL', 'NULL', 'NULL', 'NULL', 'NULL', 'NULL', 'NULL', 'NULL', 'NULL', 'NULL', 'NULL', 'NULL', 'NULL', 'NULL', 'NULL', 'NULL', 'NULL', 'NULL', 'NULL', 'NULL', 'NULL', 'NULL', 'NULL', 'NULL', 'NULL', 'NULL', 'NULL', 'NULL', 'NULL', 'NULL', 'NULL', 'NULL', 'NULL', 'NULL', 'NULL', 'NULL', 'NULL', 'NULL', 'NULL', 'NULL', 'NULL', 'NULL', 'NULL', 'NULL', 'NULL', 'NULL', 'NULL', 'NULL', 'NULL', 'NULL', 'NULL', 'NULL', 'NULL', 'NULL', 'NULL', 'NULL', 'NULL', 'NULL', 'NULL', 'NULL', 'NULL', 'NULL', 'NULL', 'NULL', 'NULL', 'NULL', 'NULL', 'NULL', 'NULL', 'NULL', 'NULL', 'NULL', 'NULL', 'NULL', 'NULL', 'NULL', 'NULL', 'NULL', 'France and Monaco', 'France and Monaco', 'France and Monaco', 'France and Monaco', 'France and Monaco', 'France and Monaco', 'France and Monaco', 'France and Monaco', 'France and Monaco', 'France and Monaco', 'France and Monaco', 'France and Monaco', 'France and Monaco', 'France and Monaco', 'France and Monaco', 'France and Monaco', 'France and Monaco', 'France and Monaco', 'France and Monaco', 'France and Monaco', 'France and Monaco', 'France and Monaco', 'France and Monaco', 'France and Monaco', 'France and Monaco', 'France and Monaco', 'France and Monaco', 'France and Monaco', 'France and Monaco', 'France and Monaco', 'France and Monaco', 'France and Monaco', 'France and Monaco', 'France and Monaco', 'France and Monaco', 'France and Monaco', 'France and Monaco', 'France and Monaco', 'France and Monaco', 'France and Monaco', 'France and Monaco', 'France and Monaco', 'France and Monaco', 'France and Monaco', 'France and Monaco', 'France and Monaco', 'France and Monaco', 'France and Monaco', 'France and Monaco', 'France and Monaco', 'France and Monaco', 'France and Monaco', 'France and Monaco', 'France and Monaco', 'France and Monaco', 'France and Monaco', 'France and Monaco', 'France and Monaco', 'France and Monaco', 'France and Monaco', 'France and Monaco', 'France and Monaco', 'France and Monaco', 'France and Monaco', 'France and Monaco', 'France and Monaco', 'France and Monaco', 'France and Monaco', 'France and Monaco', 'France and Monaco', 'France and Monaco', 'France and Monaco', 'France and Monaco', 'France and Monaco', 'France and Monaco', 'France and Monaco', 'France and Monaco', 'France and Monaco', 'France and Monaco', 'France and Monaco', 'NULL', 'NULL', 'NULL', 'NULL', 'NULL', 'NULL', 'NULL', 'NULL', 'NULL', 'NULL', 'NULL', 'NULL', 'NULL', 'NULL', 'NULL', 'NULL', 'NULL', 'NULL', 'NULL', 'NULL', 'Germany', 'Germany', 'Germany', 'Germany', 'Germany', 'Germany', 'Germany', 'Germany', 'Germany', 'Germany', 'Germany', 'Germany', 'Germany', 'Germany', 'Germany', 'Germany', 'Germany', 'Germany', 'Germany', 'Germany', 'Germany', 'Germany', 'Germany', 'Germany', 'Germany', 'Germany', 'Germany', 'Germany', 'Germany', 'Germany', 'Germany', 'Germany', 'Germany', 'Germany', 'Germany', 'Germany', 'Germany', 'Germany', 'Germany', 'Germany', 'Germany', 'NULL', 'NULL', 'NULL', 'NULL', 'NULL', 'NULL', 'NULL', 'NULL', 'NULL', 'Japan', 'Japan', 'Japan', 'Japan', 'Japan', 'Japan', 'Japan', 'Japan', 'Japan', 'Japan', 'Russia', 'Russia', 'Russia', 'Russia', 'Russia', 'Russia', 'Russia', 'Russia', 'Russia', 'Russia', 'NULL', 'Taiwan', 'NULL', 'NULL', 'NULL', 'NULL', 'NULL', 'NULL', 'NULL', 'NULL', 'NULL', 'NULL', 'NULL', 'NULL', 'NULL', 'NULL', 'NULL', 'Kazakhstan', 'NULL', 'Hong Kong SAR', 'Japan', 'Japan', 'Japan', 'Japan', 'Japan', 'Japan', 'Japan', 'Japan', 'Japan', 'Japan', 'United Kingdom', 'United Kingdom', 'United Kingdom', 'United Kingdom', 'United Kingdom', 'United Kingdom', 'United Kingdom', 'United Kingdom', 'United Kingdom', 'United Kingdom', 'NULL', 'NULL', 'NULL', 'NULL', 'NULL', 'NULL', 'NULL', 'NULL', 'NULL', 'NULL', 'NULL', 'NULL', 'NULL', 'NULL', 'NULL', 'NULL', 'NULL', 'NULL', 'NULL', 'NULL', 'NULL', 'NULL', 'NULL', 'NULL', 'NULL', 'NULL', 'NULL', 'NULL', 'NULL', 'NULL', 'NULL', 'NULL', 'NULL', 'NULL', 'NULL', 'NULL', 'NULL', 'NULL', 'NULL', 'NULL', 'NULL', 'NULL', 'NULL', 'NULL', 'NULL', 'NULL', 'NULL', 'NULL', 'NULL', 'NULL', 'NULL', 'NULL', 'NULL', 'NULL', 'NULL', 'NULL', 'NULL', 'NULL', 'NULL', 'NULL', 'NULL', 'NULL', 'NULL', 'NULL', 'NULL', 'NULL', 'NULL', 'NULL', 'NULL', 'NULL', 'NULL', 'NULL', 'NULL', 'NULL', 'NULL', 'NULL', 'NULL', 'NULL', 'NULL', 'NULL', 'Poland', 'NULL', 'NULL', 'NULL', 'NULL', 'NULL', 'NULL', 'NULL', 'NULL', 'Hungary', 'NULL', 'NULL', 'NULL', 'NULL', 'NULL', 'NULL', 'NULL', 'NULL', 'NULL', 'NULL', 'NULL', 'NULL', 'NULL', 'NULL', 'NULL', 'NULL', 'NULL', 'NULL', 'NULL', 'NULL', 'NULL', 'NULL', 'NULL', 'NULL', 'NULL', 'NULL', 'NULL', 'NULL', 'NULL', 'NULL', 'NULL', 'NULL', 'NULL', 'NULL', 'NULL', 'NULL', 'NULL', 'NULL', 'NULL', 'NULL', 'NULL', 'NULL', 'NULL', 'NULL', 'NULL', 'NULL', 'NULL', 'NULL', 'NULL', 'NULL', 'NULL', 'NULL', 'NULL', 'NULL', 'NULL', 'NULL', 'NULL', 'NULL', 'NULL', 'NULL', 'NULL', 'NULL', 'NULL', 'NULL', 'NULL', 'NULL', 'NULL', 'NULL', 'NULL', 'NULL', 'NULL', 'NULL', 'NULL', 'NULL', 'NULL', 'NULL', 'NULL', 'NULL', 'NULL', 'NULL', 'NULL', 'NULL', 'NULL', 'NULL', 'NULL', 'NULL', 'NULL', 'NULL', 'NULL', 'NULL', 'China', 'China', 'China', 'China', 'China', 'China', 'NULL', 'NULL', 'NULL', 'NULL', 'NULL', 'NULL', 'NULL', 'NULL', 'NULL', 'NULL', 'NULL', 'NULL', 'NULL', 'NULL', 'NULL', 'NULL', 'NULL', 'NULL', 'NULL', 'NULL', 'NULL', 'NULL', 'NULL', 'NULL', 'NULL', 'NULL', 'NULL', 'NULL', 'NULL', 'NULL', 'NULL', 'NULL', 'NULL', 'NULL', 'NULL', 'NULL', 'NULL', 'NULL', 'NULL', 'NULL', 'NULL', 'NULL', 'NULL', 'NULL', 'NULL', 'NULL', 'NULL', 'NULL', 'NULL', 'NULL', 'NULL', 'NULL', 'NULL', 'NULL', 'NULL', 'NULL', 'NULL', 'NULL', 'Canada', 'Canada', 'NULL', 'NULL', 'NULL', 'NULL', 'NULL', 'NULL', 'NULL', 'NULL', 'NULL', 'NULL', 'NULL', 'NULL', 'NULL', 'NULL', 'NULL', 'NULL', 'NULL', 'NULL', 'NULL', 'NULL', 'NULL', 'NULL', 'NULL', 'NULL', 'NULL', 'NULL', 'NULL', 'NULL', 'NULL', 'NULL', 'NULL', 'NULL', 'NULL', 'NULL', 'NULL', 'NULL', 'NULL', 'NULL', 'NULL', 'NULL', 'NULL', 'NULL', 'NULL', 'NULL', 'NULL', 'NULL', 'NULL', 'NULL', 'NULL', 'NULL', 'NULL', 'NULL', 'NULL', 'NULL', 'NULL', 'NULL', 'NULL', 'NULL', 'NULL', 'NULL', 'NULL', 'NULL', 'NULL', 'NULL', 'NULL', 'NULL', 'NULL', 'NULL', 'NULL', 'NULL', 'NULL', 'NULL', 'NULL', 'NULL', 'NULL', 'NULL', 'NULL', 'NULL', 'NULL', 'NULL', 'NULL', 'NULL', 'NULL', 'NULL', 'NULL', 'NULL', 'NULL', 'NULL', 'NULL', 'NULL', 'NULL', 'NULL', 'NULL', 'NULL', 'NULL', 'NULL', 'NULL', 'NULL', 'NULL', 'NULL', 'NULL', 'NULL', 'NULL', 'NULL', 'NULL', 'NULL', 'NULL', 'NULL', 'NULL', 'Mongolia', 'NULL', 'North Korea', 'NULL', 'NULL', 'NULL', 'NULL', 'NULL', 'NULL', 'NULL', 'NULL', 'NULL', 'NULL', 'NULL', 'NULL', 'South Korea', 'NULL', 'NULL', 'NULL', 'NULL', 'Thailand', 'NULL', 'NULL', 'Singapore', 'NULL', 'India', 'NULL', 'NULL', 'Vietnam', 'NULL', 'NULL', 'NULL', 'NULL', 'NULL', 'Indonesia', 'Austria', 'Austria', 'Austria', 'Austria', 'Austria', 'Austria', 'Austria', 'Austria', 'Austria', 'Austria', 'Austria', 'Austria', 'Austria', 'Austria', 'Austria', 'Austria', 'Austria', 'Austria', 'Austria', 'Austria', 'NULL', 'NULL', 'NULL', 'NULL', 'NULL', 'NULL', 'NULL', 'NULL', 'NULL', 'NULL', 'Australia', 'Australia', 'Australia', 'Australia', 'Australia', 'Australia', 'Australia', 'Australia', 'Australia', 'Australia', 'NULL', 'NULL', 'NULL', 'NULL', 'NULL', 'NULL', 'NULL', 'NULL', 'NULL', 'NULL', 'NULL', 'NULL', 'NULL', 'NULL', 'NULL', 'Malaysia', 'NULL', 'NULL', 'NULL', 'NULL', 'NULL', 'NULL', 'NULL', 'NULL', 'NULL', 'NULL', 'NULL', 'NULL', 'NULL', 'NULL', 'NULL', 'NULL', 'NULL', 'NULL', 'NULL', 'NULL', 'NULL', 'NULL', 'ISBN', 'ISBN']


n=10
f=open("info.txt", "w")

for i in range(1, n+1):
    qr_code_img=cv2.imread('./img/img{}.jpg'.format(i))
    f.write("[img{}]".format(i))
    
    print('img read......')
    plt.imshow(qr_code_img)

    print('convert gray scale....')
    gray=cv2.cvtColor(qr_code_img, cv2.COLOR_BGR2GRAY)
    plt.imshow(gray, cmap='gray')

    decoded=pyzbar.decode(gray)
    print("data info : ",decoded)

    for d in decoded:
        
        if d.data.decode('utf-8').isdigit():
            f.write(" type"+d.type+" : "+d.data.decode('utf-8')+"["+code_country[int(str(d.data.decode('utf-8'))[:3])]+"] \n")

        else:    
            f.write(" type"+d.type+" : "+d.data.decode('utf-8')+"\n")
            
        cv2.rectangle(qr_code_img, (d.rect[0], d.rect[1]), (d.rect[0]+d.rect[2], d.rect[1]+d.rect[3]), (0, 255, 0), 10)
        cv2.imwrite('save/save_img{}.jpg'.format(i), qr_code_img)

f.close()


#https://en.wikipedia.org/wiki/List_of_GS1_country_codes

#EAN-8 : 표준형 바코드 타입
# EAN-8 바코드(13자리) :  국가번호(3자리) + 제조업체(4자리) + 상품번호(4가지) + 체크숫자(1자리)

#d.data의 앞 3자리(국가식별코드)를 통해 어느나라 상품인지 기록하기
